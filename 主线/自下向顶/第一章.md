# 什么是因特网

因特网是由无数个规模不一的独立网络通过标准化协议互联成的巨型分布式系统

## 具体构成
### 端系统
端系统相对于主机，更强调处于**网络边缘参加网络通信的设备**，在大多数情况下可以等同主机

每个端系统都有一个IP，对于大部分端系统都采用NAT映射为公网IP

### 分组交换机
网络中的**数据转发设备**，实现数据的**存储-转发**功能

### 因特网服务提供商（ISP）

​	向用户提供网络接入，网络托管等服务的组织，是连接端系统与全球因特网的桥梁和网关

## 服务描述

### 分布式应用程序

运行在**多个网络连接的计算机上**，通过**相互协作**共同完成一个**统一业务目标**的软件系统

它对外表现为单一应用

### 套接字接口

套接字接口是一套由操作系统提供的、让应用程序可以使用网络进行通信的标准函数接口。

它是应用程序进入互联网的唯一入口。

##  什么是协议

通信对等实体共同遵循的一套**规则**，让设备能按预定格式、顺序、有意义地交流



# 网络边缘

“网络边缘（network edge）”指的是**网络中靠近终端用户的一侧**，也就是互联网的“入口和出口地带”。它是数据进入网络或离开网络的边界区域。

## 接入网

将端系统物理连接到其边缘路由器的网络

边缘路由器是端系统到任何远端系统的路径上的第一台路由器

### ISP接入类型(WAN)

* 数字用户线(DSL)

  利用普通电话线提供宽带上网的技术

* 电缆接入

  利用有线电视网的同轴电缆提供宽带上网的技术，相对DSL带宽更高

* 光纤接入(FTTH)

  利用光纤连接运营商提供上网

  用**光**来上网，稳定，高速，抗干扰强

* 卫星链路接入

  将上网信号发送到卫星，由卫星转发数据并传回

### 局域网接入类型(LAN)

* 以太网

  以太网是一种局域网的通信规则（链路层协议），负责设备之间如何用帧交换数据
  
* WiFi

  无线局域网（WLAN）技术，它属于 **链路层协议（IEEE 802.11 标准）**，用无线电波代替网线

### 广域网接入类型

通过蜂窝移动网络将终端设备连接到运营商的广域网，从而接入互联网的一种接入方式

* 3G/4G/5G

## 物理介质

### 引导性媒体

信号沿着固定的物理路径传播

* 双绞铜线

* 同轴电缆

* 光纤

### 非引导性媒体

  信号在空气/空间中自由传播

  * WiFi
  * 蓝牙
  * 蜂窝网络
  * 微波通信

# 网络核心

整个互联网中负责高速转发分组，转发的核心网络结构

### 分组交换

报文能够包含协议设计者需要的任何东西

源将长报文划分为较小的数据块，称之为分组

* 存储转发机制

  完整接受整个分组，并检查再决定怎么转发

* 排队延迟及数据分组丢失

  * 分组交换机具有一个输出缓存，用于存储路由器准备发往某条链路的分组

  每台分组交换机有多条链路相连，如果到达的分组发现需要传输的链路正忙于传输其他分组，则该分组必须在输出缓存中等待。分组除了必须接受存储转发时延还需要接受输出缓存的排队时延，同时，由于分组交换机的缓存空间有限，可能出现一个到达的分组没有额外的缓存存储。在此情况下，将会出现分组丢失（丢包），到达的分组或已经排队的分组之一将被丢弃

* 转发表和路由选择协议

  每个分组首部都会携带源端系统的IP，每个路由器都维护一张转发表，路由器根据分组中的目标IP决定该分组如何转发

### 电路交换（已不常用）

建立一条持续，专用的线路进行通信，通信完后才释放

* 电路交换网络通过多路复用让多条电路在同一物理介质上进行网络通信

### 分组交换成为互联网主流的原因

* 互联网的数据是突发的
* 分组交换能够使全球共享链路
* 分组交换天然支持扩展

| 特点                   | 电路交换             | 分组交换         |
| ---------------------- | -------------------- | ---------------- |
| 通信方式               | 一条独占电路         | 分组共享链路     |
| 通信前是否要建立连接？ | 需要                 | 不需要           |
| 带宽                   | 固定独占             | 动态共享         |
| 延迟                   | 稳定                 | 波动（排队）     |
| 适用应用               | 传统语音电话         | 数据、互联网     |
| 链路利用率             | 低                   | 极高             |
| 扩展性                 | 差                   | 极好             |
| 故障恢复               | 差（电路断了就完了） | 强（分组可绕路） |
| 网络设计哲学           | 面向连接             | 面向无连接       |

## 网络的网络

**互联网是由许多独立网络互联而成的体系，不是一个单一网络。**

**1. 网络边缘（端系统）**
 用户设备，用应用程序产生数据。

**2. 接入网**
 把端系统连接到 ISP（光纤、DSL、Cable、4G/5G）。

**3. ISP（互联网服务提供商）**

- 小 ISP 连接到更大的 ISP
- 形成层次化结构（第一层、第二层、第三层）
- 通过对等 peering 和传输 transit 互联

**4. 自治系统（AS）**
 每个 ISP 是一个独立的 AS
 AS 之间通过 BGP 协调

* 自治系统，就是由同一个组织管理、运行，并使用统一路由策略的一大块网络。
* BGP（Border Gateway Protocol，边界网关协议）是互联网中**自治系统之间**用来交换路由信息的协议。

**5. 互联网结构特征**

- 去中心化
- 分层
- 网络中的网络
- 无需单一控制者

# 分组交换的三件事

在现实中，网络的数据必定会在传输的过程中遇到各种各样的情况

##  分组交换网中的时延

分组经由一系列节点会受到各种时延

* 处理时延

  检查 bit 错误、查路由表、做首部处理

* 排队时延

  流量拥塞时，分组在路由器队列中排队等待

* 传输时延

  把一整个分组“推出”链路的时间。
  公式 = L / R（分组长度除以链路带宽）

* 传播时延

  电磁波/光信号在链路上传播的物理时间。
  公式 = d / s（物理距离除以信号速度）

> 传输时延是“把分组推上链路的时间”
> 传播时延是“分组在链路上跑的时间”

## 排队时延和丢包

排队时延发生在路由器或交换机内部的输出丢列
评测一个节点的性能常常不仅根据时延来度量，而且根据丢包的概率来度量

**链路的“瞬时流量强度”**
 常用公式表示为：
$$
\text{流量强度} = \frac{L \cdot a}{R}
$$

|  L   |       a       |  R   |
| :--: | :-----------: | :--: |
| 分组长度 | 到达速率（每秒多少个分组） | 链路带宽 |

* 流量强度 **< 1** → 平均排队时间很短
* 流量强度 **≈ 1** → 排队时间爆炸式增长
* 流量强度 **≥ 1** → 队列永远排不完，路由器开始丢包

## 端到端时延

1. **处理时延 d<sub>proc</sub>**

路由器检查分组头、查找路由表、做一些基本校验。

通常微秒级，非常小。

------

2. **传输时延 d<sub>trans</sub>**

分组被“推出”链路所需要的时间。

公式：
$$
d_{\text{trans}} = \frac{L}{R}
$$

- L 是分组长度（比特数）
- R 是链路带宽（比特/秒）

------

3. **传播时延d<sub>prop</sub>**

信号在链路中“跑”的时间。

公式：
$$
d_{\text{prop}} = \frac{d}{s}
$$

- d 是物理距离
- s 是电磁信号速度（光纤中约为 2×10⁸ m/s）

假设分组经过N-1台路由器，网络无拥塞：
$$
d_{\text{总时延}} = N(d_{\text{proc}} + d_{\text{trans}} + d_{\text{prop}})
$$

## 计算机网络中的吞吐量

吞吐量受限于链路最小传输速率，近似得到瓶颈链路的传输速率：

如果：

- Rₛ < R𝚌：服务器这一段最慢 → 服务器端限制吞吐量
- R𝚌 < Rₛ：客户端接入链路最慢 → 客户端接入链路限制吞吐量

**因此**:
$$
\text{吞吐量} = \min(R_s, R_c)
$$

# 协议层次及其服务类型

## 分层的体系结构

网络被划分成多个功能层，每层只负责自己那部分工作，上层依赖下层，但彼此互不干扰



|  OSI模型   |
| :--------: |
|   应用层   |
|   表示层   |
|   会话层   |
|   传输层   |
|   网络层   |
| 数据链路层 |
|   物理层   |

## 封装

