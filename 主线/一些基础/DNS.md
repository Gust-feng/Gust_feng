# 什么是 DNS

**DNS**（Domain Name System，域名系统）是将人类易于理解的域名转换为机器易于理解的 IP 地址的系统。

## 域名层级结构

域名采用层级结构，从右到左依次为：

- **根域** `.` - 全球有 13 组根域名服务器
- **顶级域** - 如 `.com`、`.cn`、`.org` 等
- **二级域** - 企业或个人从注册商购买的域名
- **三级域及以下** - 在二级域基础上划分的子域名，可以无限延伸

**示例**：`feng.gust.com.`
- `.` → 根域
- `.com` → 顶级域
- `gust` → 二级域
- `feng` → 三级域

## DNS 记录类型

| 类型  | 用途                           | 示例                                      |
| :---: | :----------------------------- | :---------------------------------------- |
|   A   | 将域名映射到 IPv4 地址         | `gust.com IN A 192.168.1.1`               |
| AAAA  | 将域名映射到 IPv6 地址         | `gust.com IN AAAA 2001:db8::1`            |
| CNAME | 将域名指向另一个域名（别名）   | `www.gust.com IN CNAME gust.com`          |
|  MX   | 指定邮件服务器地址             | `gust.com IN MX 10 mail.gust.com`         |
|  TXT  | 存储任意文本信息（如身份验证） | `gust.com IN TXT "v=spf1 include:_spf"`   |
|  NS   | 指定权威 DNS 服务器            | `gust.com IN NS ns1.gust.com`             |
|  PTR  | 反向解析：IP 地址映射到域名    | `1.0.0.127.in-addr.arpa. IN PTR gust.com` |
|  SOA  | 存储区域权威信息和同步参数     | 包含主 DNS、邮箱、序列号等信息            |

**说明**：
- `IN` 表示 Internet 类型，现代 DNS 记录的 Class 始终为 IN
- PTR 记录使用反向 IP：`.in-addr.arpa` 用于 IPv4，`.ip6.arpa` 用于 IPv6

## DNS 解析过程

1. **查询本地缓存** - 检查本地是否已缓存 DNS 记录
2. **请求本地 DNS 服务器** - 若缓存未命中，向本地 DNS 服务器发起请求
3. **递归查询** - 本地 DNS 服务器依次向根域、顶级域、权威域名服务器查询
4. **返回并缓存结果** - 将查询结果返回客户端并缓存，提高后续查询效率

## TTL（生存时间）与缓存

**TTL**（Time To Live）指定了 DNS 记录在缓存中保存的时长（单位：秒）。

- **作用**：平衡查询效率与数据时效性
- **常见设置**：
  - 静态记录：3600 秒（1 小时）或更长
  - 动态记录：300 秒（5 分钟）或更短
  - 迁移期间：建议设置较短 TTL，便于快速切换

**示例**：`gust.com 3600 IN A 192.168.1.1`（该记录缓存 1 小时）

## DNS 协议载体

DNS 查询支持两种传输协议：

- **UDP（端口 53）** - 默认协议，速度快，适合标准查询（小于 512 字节）
- **TCP（端口 53）** - 用于大响应（超过 512 字节）或区域传输（AXFR）
- **DNS over HTTPS（DoH）** - 使用 HTTPS（端口 443）加密传输
- **DNS over TLS（DoT）** - 使用 TLS（端口 853）加密传输


### 完整解析流程示例

当你在浏览器输入 `www.gust.com` 并按下回车：

1. **浏览器检查自身缓存** - "我之前访问过这个网站吗？有记录直接用！"
2. **检查操作系统缓存** - "系统里有没有保存过这个域名的 IP？"
3. **查询本地 DNS 服务器**（通常是运营商提供）- "我这里也没有，让我帮你问问..."
4. **本地 DNS 询问根域名服务器** - "`.` 大哥，`.com` 域名该找谁？"
5. **根域返回顶级域服务器地址** - "去找 `.com` 的服务器，地址是 xxx"
6. **询问 `.com` 顶级域服务器** - "`.com` 老弟，`gust.com` 在哪？"
7. **顶级域返回权威服务器地址** - "`gust.com` 的权威服务器地址是 yyy"
8. **询问 `gust.com` 权威服务器** - "请问 `www.gust.com` 的 IP 是多少？"
9. **权威服务器返回 A 记录** - "`www.gust.com` 的 IP 是 `192.168.1.100`"
10. **层层返回并缓存** - 本地 DNS 把结果告诉你的电脑，大家都缓存一份
11. **浏览器拿到 IP** - 终于知道了！开始向 `192.168.1.100` 发起 HTTP 请求

**整个过程通常只需几十毫秒，因为各级缓存大大减少了实际查询次数。**